################################################################################################################################################################################################################################################################################################################################
# Fetching latest AMI ID of ubuntu 22.04
#################################################################################################################


data "aws_ami" "latest" {
    most_recent = true
   
    filter {
      name = "virtualization-type"
      values = ["hvm"]
    }
    filter {
        name = "name"
        values = ["ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"]
    }
     owners = ["099720109477"]
}


################################################################################################################################################################################################################################################################################################################################################################################################
# Fetching latest AMI ID of Debian 12
################################################################################################################################################################################################################################################################################################################################################################
/*
data "aws_ami" "latest" {
    most_recent = true
   
    filter {
      name = "architecture"
      values = ["x86_64"]
    }
    filter {
        name = "name"
        values = ["debian-12-amd64-*-*"]
    }
     owners = ["136693071363"]
}
*/
##################################################################################################################
# Fetching latest AMI ID of Amazon linux 2023
##################################################################################################################
/*
data "aws_ami" "latest" {
    most_recent = true
   
    filter {
      name = "architecture"
      values = ["x86_64"]
    }
    filter {
        name = "name"
        values = ["al2023-ami-*-kernel-*-x86_64"]
    }
    owners = ["137112412989"]
}
*/
###########################################################################################################
# Creating EC2 instance out of this latest AMI
###########################################################################################################

resource "aws_instance" "jenkins-server" {
    ami = data.aws_ami.latest.id
    instance_type = "t2.micro"
    subnet_id = aws_subnet.our-public-subnet.id
    user_data = file("./jenkins-server.sh")
    key_name = "terraform"
    security_groups = [aws_security_group.our-security-group.id]
    tags = {
        Name = "jenkins-server"
    }
}